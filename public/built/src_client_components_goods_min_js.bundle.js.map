{"version":3,"file":"src_client_components_goods_min_js.bundle.js","mappings":"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QAAQ,iBAAIzE,0DAAA,yBAAGA,0DAAA;MAAOmF,SAAS,EAAC;IAAY,GAAE,cAAc,GAAG,CAAChE,KAAK,CAACsD,QAAQ,GAAG,IAAI,EAAEuC,OAAO,CAAC,CAAC,CAAC,GAAG,IAAY,CAAI,CAAC,eAC5HhH,0DAAA,yBAAGA,0DAAA;MAAOmF,SAAS,EAAC;IAAY,GAAEM,OAAe,CAAI,CAChD;EAAC;EAET;AACD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iEAAevE,QAAQ,EAAC;;AAExB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;AC9pBO,SAASJ,QAAQA,CAACmG,IAAI,EAAEC,IAAI,EAAEC,IAAI,EAAEC,IAAI,EAAE;EAC7C,IAAIC,CAAC,GAAG,IAAI,CAAC,CAAC;EACd,IAAIC,IAAI,GAAGC,KAAK,CAACJ,IAAI,GAACF,IAAI,CAAC;EAC3B,IAAIO,IAAI,GAAGD,KAAK,CAACH,IAAI,GAACF,IAAI,CAAC;EAC3B,IAAID,IAAI,GAAGM,KAAK,CAACN,IAAI,CAAC;EACtB,IAAIE,IAAI,GAAGI,KAAK,CAACJ,IAAI,CAAC;EAEtB,IAAIM,CAAC,GAAGC,IAAI,CAACC,GAAG,CAACL,IAAI,GAAC,CAAC,CAAC,GAAGI,IAAI,CAACC,GAAG,CAACL,IAAI,GAAC,CAAC,CAAC,GAC3CI,IAAI,CAACC,GAAG,CAACH,IAAI,GAAC,CAAC,CAAC,GAAGE,IAAI,CAACC,GAAG,CAACH,IAAI,GAAC,CAAC,CAAC,GAAGE,IAAI,CAACE,GAAG,CAACX,IAAI,CAAC,GAAGS,IAAI,CAACE,GAAG,CAACT,IAAI,CAAC;EACrE,IAAIU,CAAC,GAAG,CAAC,GAAGH,IAAI,CAACI,KAAK,CAACJ,IAAI,CAACK,IAAI,CAACN,CAAC,CAAC,EAAEC,IAAI,CAACK,IAAI,CAAC,CAAC,GAACN,CAAC,CAAC,CAAC;EACpD,IAAIO,CAAC,GAAGX,CAAC,GAAGQ,CAAC;EACb,OAAOG,CAAC;AACZ;;AAEA;AACO,SAAST,KAAKA,CAACU,KAAK,EAAE;EACzB,OAAOA,KAAK,GAAGP,IAAI,CAACQ,EAAE,GAAG,GAAG;AAChC","sources":["webpack://fartza.ru/./src/client/components/goods_min.js","webpack://fartza.ru/./src/client/math/distance.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { connect, useDispatch, useSelector } from 'react-redux';\r\nimport { bindActionCreators } from '@reduxjs/toolkit';\r\nimport { fetchAllGoodsState, goodsAPI } from '../store/services/goods_service';\r\nimport { store } from '../app';\r\nimport { setLastArgs } from '../store/reducers/goods_slice';\r\nimport { Carousel } from 'flowbite-react';\r\nimport { Card } from 'flowbite-react';\r\nimport { useFetchAllGoodsCatsQuery, useFetchAllGoodsQuery } from '../store/services/goods_service';\r\nimport { calcCrow } from '../math/distance';\r\nimport { useEffect } from 'react';\r\nimport { useFetchGoodsByNickQuery } from '../store/services/goods_service';\r\nimport { useGetFavoritesQuery } from '../store/services/users_service';\r\n\r\nfunction GoodsMin(props) {\r\n//\tunsubscribe = null;\r\n\r\n\t/*constructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {goods: null, count: null, isLoading: null, error: null};\r\n\t\tthis.move = this.move.bind(this);\r\n\t\t//this.state = { lastArgs: null };\r\n\t\t//this.state = { goods: useSelector((state) => state.goods) };\r\n\t\t//this.getNew = this.getNew.bind(this);\r\n\t\t//this.getPopular = this.getPopular.bind(this);\r\n  \t\t//this.dispatch = useDispatch();\r\n\t\t//const subscriptionChangeState = this.props.emitter.subscribe(\"CHANGE\", (state) => this.setState({ goods: state }));\r\n\t}\r\n\r\n\t/*componentDidUpdate(prevProps) {\r\n\t\tif (this.state.first || JSON.stringify(this.props.lastArgs) !== JSON.stringify(prevProps.lastArgs)) {\r\n\t\t\tthis.setState({first: false});\r\n\t\t\tconsole.log(this.props.lastArgs);\r\n\t\t\tthis.props.fetchAllGoods(this.props.lastArgs);\r\n\t\t}\r\n\t}*/\r\n\r\n\t//getNew() {\r\n\t\t/*const data = new FormData();\r\n\t\tdata.append('command', 'getGoods');\r\n\t\tdata.append('since', 0);*/\r\n\t\t/*fetch('/api', {\r\n\t\t\tmethod: 'POST',\r\n\t\t    headers: {\r\n\t\t      'Accept': 'application/json',\r\n\t\t      'Content-Type': 'application/json'\r\n\t\t    },\r\n\t\t    body: JSON.stringify({command: 'getNew', since: 0})\r\n\t\t}).then(response => {\r\n\t\t\tresponse.json().then(body => {\r\n\t\t\t\tthis.setState({ goods: body.goods[0] });\r\n\t\t\t});\r\n\t\t});*/\r\n\t\t/*const searchParams = new URLSearchParams(location.search);\r\n\t\tthis.props.sendAPIRequest({ command: 'searchGoods', word: (searchParams.get('query') && searchParams.get('query').length > 1) ? searchParams.get('query') : \"\", since: 0, sort: 'new' }, '/api', 'POST').then(resolve => {\r\n\t\t\tif (resolve.body.goods[0].length == 0) {\r\n\t\t\t\tthis.props.updateGoods('Ничего не найдено!');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.props.updateGoods(resolve.body.goods[0]);\r\n\t\t}).catch(reject => {\r\n\t\t\tthis.props.updateGoods(reject.error);\r\n\t\t});*/\r\n\t\t\r\n\t\t//const searchParams = new URLSearchParams(location.search);\r\n\t\t//this.props.getGoodsFromAPI((searchParams.get('query') && searchParams.get('query').length > 1) ? searchParams.get('query') : \"\", 0, 'new');\r\n\t\t\r\n\t\t/*const searchParams = new URLSearchParams(location.search);\r\n\t\tthis.props.getGoodsAll({ word: ((searchParams.get('query') && searchParams.get('query').length > 1) ?\r\n\t\t\tsearchParams.get('query') : \"\"), since: 0, sort: 'new'});*/\r\n\t\t//console.log(10);\r\n\t//}\r\n\r\n\t//getPopular() {\r\n\t\t/*const searchParams = new URLSearchParams(location.search);\r\n\t\tthis.props.sendAPIRequest({ command: 'searchGoods', word: (searchParams.get('query') && searchParams.get('query').length > 1) ? searchParams.get('query') : \"\", since: 0, sort: 'popular' }, '/api', 'POST').then(resolve => {\r\n\t\t\tif (resolve.body.goods[0].length == 0) {\r\n\t\t\t\tthis.props.updateGoods('Ничего не найдено!');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.props.updateGoods(resolve.body.goods[0]);\r\n\t\t}).catch(reject => {\r\n\t\t\tthis.props.updateGoods(reject.error);\r\n\t\t});*/\r\n\t\t\r\n\t\t//const searchParams = new URLSearchParams(location.search);\r\n\t\t//this.props.getGoodsFromAPI((searchParams.get('query') && searchParams.get('query').length > 1) ? searchParams.get('query') : \"\", 0, 'popular');\r\n\t\t/*const searchParams = new URLSearchParams(location.search);\r\n\t\tthis.props.getGoodsAll({ word: ((searchParams.get('query') && searchParams.get('query').length > 1) ?\r\n\t\t\tsearchParams.get('query') : \"\"), since: 0, sort: 'popular'})\r\n\t}*/\r\n\r\n\tconst dispatch = useDispatch()\r\n\r\n\tconst lastArgs = useSelector((state) => state.goodsReducer.lastArgs);\r\n\r\n\tlet query\r\n    if (lastArgs.category)\r\n        query = useFetchAllGoodsCatsQuery\r\n\telse if (props.option === \"profile\") \r\n\t\tquery = useFetchGoodsByNickQuery\r\n\telse if (props.option === \"favorites\")\r\n\t\tquery = useGetFavoritesQuery\r\n    else\r\n        query = useFetchAllGoodsQuery\r\n\r\n    const { data, error, isLoading } = query(props.option !== \"profile\" ? lastArgs : { ...lastArgs, nick: window.location.pathname.split('/').pop() || window.location.pathname.split('/').slice(0, -1).pop()})\r\n\r\n\t//componentDidUpdate(prevProps) {\r\n\t\t/*let fetch = this.props.lastArgs?.category ? this.props.fetchAllGoodsCatsState : this.props.fetchAllGoodsState\r\n\t\tlet fetch2 = prevProps.lastArgs?.category ? prevProps.fetchAllGoodsCatsState : prevProps.fetchAllGoodsState\r\n\t\tif (fetch(this.props.lastArgs).isLoading !== fetch2(prevProps.lastArgs).isLoading ||\r\n\t\t\tfetch(this.props.lastArgs).isUninitialized !== fetch2(prevProps.lastArgs).isUninitialized ||\r\n\t\t\tfetch(this.props.lastArgs).isError !== fetch2(prevProps.lastArgs).isError ||\r\n\t\t\tfetch(this.props.lastArgs).data !== fetch2(prevProps.lastArgs).data) {\r\n\t\t\tif (!fetch(this.props.lastArgs).isLoading &&\r\n\t\t\t\t!fetch(this.props.lastArgs).isUninitialized) {\r\n\t\t\t\tif (!fetch(this.props.lastArgs).isError) {\r\n\t\t\t\t\tthis.setState({goods: fetch(this.props.lastArgs).data.goods[0].rows, count: fetch(this.props.lastArgs).data.goods[0].count});\r\n\t\t\t\t\t//console.log(goods);\r\n\t\t\t\t\t/*for (let i = 0; i < goods.length; i++)\r\n\t\t\t\t\t\trows.push(<MyCard id={goods[i].id} name={goods[i].name} img={goods[i].photos} price={goods[i].price}\r\n\t\t\t\t\t\t\tcreatedAt={goods[i].created_at} nickname={goods[i].user?.nickname}\r\n\t\t\t\t\t\t\trating={goods[i].user?.rating} />);*/\r\n\t\t\t\t\t/*if (rows.length < 12)\r\n\t\t\t\t\t\twhile (rows.length < 12)\r\n\t\t\t\t\t\t\trows.push(<div></div>)*/\r\n\t\t\t\t/*} else {\r\n\t\t\t\t\t//rows = fetch(this.props.lastArgs).error.data.error;\r\n\t\t\t\t\tthis.setState({isError: fetch(this.props.lastArgs).error.data.error});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t//rows = 'Подождите, идет загрузка...';\r\n\t\t\t\tthis.setState({isLoading: 'Подождите, идет загрузка...'});\r\n\t\t\t}\r\n\t\t}*/\r\n\t\t/*if (this.props !== prevProps) {\r\n\t\t\tconsole.log(this.props.fetchAllGoodsState(this.props.lastArgs).data);\r\n\t\t}\r\n\t}*/\r\n\r\n\t//componentDidUpdate(prevProps) {\r\n/*\r\n\t\tconst { fetchAllGoods } = this.props;\r\n\t\t// Start a subscription for the component to the cached data\r\n\t\tconst { unsubscribe } = fetchAllGoods();\r\n\t\r\n\t\t// Store the unsubscribe promise for later use\r\n\t\tthis.unsubscribe = unsubscribe;\r\n*/\r\n\r\n\t/*\tif (this.state.first || JSON.stringify(this.props.lastArgs) !== JSON.stringify(prevProps.lastArgs)) {\r\n\t\t\tthis.setState({first: false});\r\n\t\t\tconst searchParams = new URLSearchParams(location.search);\r\n\t\t\tlet lastArgs = { word: ((searchParams.get('query') && searchParams.get('query').length > 1) ?\r\n\t\t\t\tsearchParams.get('query') : \"\"), since: 0};\r\n\t\t\tif (!searchParams.get('category')) {\r\n\t\t\t\tif (searchParams.get('sort') == 'new' || !searchParams.get('sort')) {\r\n\t\t\t\t\tthis.props.fetchAllGoods({ ...lastArgs, sort: 'new' });\r\n\t\t\t\t\tthis.props.setLastArgs({ ...lastArgs, sort: 'new' });\r\n\t\t\t\t\t//this.setState({ lastArgs: { ...lastArgs, sort: 'new' } });\r\n\t\t\t\t}\r\n\t\t\t\telse if (searchParams.get('sort') == 'popular') {\r\n\t\t\t\t\tthis.props.fetchAllGoods({ ...lastArgs, sort: 'popular' });\r\n\t\t\t\t\tthis.props.setLastArgs({ ...lastArgs, sort: 'popular' });\r\n\t\t\t\t\t//this.setState({ lastArgs: { ...lastArgs, sort: 'popular' } });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (searchParams.get('sort') == 'new' || !searchParams.get('sort')) {\r\n\t\t\t\t\tthis.props.fetchAllGoodsCats({ ...lastArgs, sort: 'new', category: searchParams.get('category') });\r\n\t\t\t\t\tthis.props.setLastArgs({ ...lastArgs, sort: 'new', category: searchParams.get('category') });\r\n\t\t\t\t}\r\n\t\t\t\telse if (searchParams.get('sort') == 'popular') {\r\n\t\t\t\t\tthis.props.fetchAllGoodsCats({ ...lastArgs, sort: 'popular', category: searchParams.get('category') });\r\n\t\t\t\t\tthis.props.setLastArgs({ ...lastArgs, sort: 'popular', category: searchParams.get('category') });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}*/\r\n\r\n\t/*componentDidUpdate(prevProps) {\r\n\t\tif (this.props.goods !== prevProps.goods)\r\n\t\t\tthis.setState({goods: this.props.goods});\r\n\t}*/\r\n\r\n\t/*componentWillReceiveProps(nextProps) {\r\n\t\tconsole.log(nextProps.goods);\r\n\t\tif (!nextProps.goods) {\r\n\t\t\tconsole.log(10000000000000);\r\n\t\t\tif (!window.location.href.match(\"search=true\")) {\r\n\t\t\t\tif (window.location.href.match(\"sort=new\") || !window.location.href.match(\"sort\")) {\r\n\t\t\t\t\tthis.getNew();\r\n\t\t\t\t}\r\n\t\t\t\telse if (window.location.href.match(\"sort=popular\")) {\r\n\t\t\t\t\tthis.getPopular();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setState({goods: nextProps.goods});\r\n\t\t}\r\n\t}*/\r\n\r\n\t/*componentWillReceiveProps(newProps) {\r\n\t\tconsole.log(newProps.goods);\r\n\t\tthis.setState({ goods: newProps.goods });\r\n\t}*/\r\n\r\n\tuseEffect(() => {\r\n\t\tgetLocation();\r\n\t}, []);\r\n\r\n\tfunction getLocation() {\r\n\t\tif (navigator.geolocation) {\r\n\t\t\tnavigator.geolocation.getCurrentPosition(showPosition);\r\n\t\t} else { \r\n\t\t\talert(\"Разрешите геолокацию чтобы видеть ближайшие товары...\");\r\n\t\t}\r\n\t}\r\n\t\t\r\n\tfunction showPosition(position) {\r\n\t\tdispatch(setLastArgs({...lastArgs, lat: position.coords.latitude, lon: position.coords.longitude}));\r\n\t}\r\n\r\n\tfunction move(arg) {\r\n\t\tif (arg === \"left\") {\r\n\t\t\tdispatch(setLastArgs({...lastArgs, since: lastArgs.since - 1}));\r\n\t\t\t/*let searchParams = new URLSearchParams(location.search);\r\n\t\t\tsearchParams.set('since', (this.props.lastArgs.since - 1).toString());\r\n\t\t\twindow.history.replaceState({}, '', `${location.pathname}?${searchParams}`);*/\r\n\t\t}\r\n\t\telse if (arg === \"right\") {\r\n\t\t\tdispatch(setLastArgs({...lastArgs, since: lastArgs.since + 1}));\r\n\t\t\t/*let searchParams = new URLSearchParams(location.search);\r\n\t\t\tsearchParams.set('since', (this.props.lastArgs.since + 1).toString());\r\n\t\t\twindow.history.replaceState({}, '', `${location.pathname}?${searchParams}`);*/\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdispatch(setLastArgs({...lastArgs, since: arg - 1}));\r\n\t\t\t/*let searchParams = new URLSearchParams(location.search);\r\n\t\t\tsearchParams.set('since', arg.toString());\r\n\t\t\twindow.history.replaceState({}, '', `${location.pathname}?${searchParams}`);*/\r\n\t\t\r\n\t\t}\r\n\t}\r\n\r\n\t//render() {\r\n\t\t/*let rows = [];\r\n\t\tlet rowsGroups = [];\r\n\t\tlet j = 0;\r\n\t\tfor (let i = 0; i < this.state.goods.length; i++) {\r\n\t\t\trows.push(<Card name={this.state.goods[i].name} img={this.state.goods[i].photos} price={this.state.goods[i].price} createdAt={this.state.goods[i].created_at} />);\r\n\t\t\tj++;\r\n\t\t\tif (j == 3 || i == this.state.goods.length - 1) {\r\n\t\t\t\tj = 0;\r\n\t\t\t\trowsGroups.push(<div className=\"card-group\">{rows}</div>);\r\n\t\t\t\trows = [];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<div>\r\n\t\t\t  {rowsGroups}\r\n\t\t\t</div>\r\n\t\t);*/\r\n\t\t//console.log(this.state.goods);\r\n\t\tlet rows = [];\r\n\t\t/*let count;*/\r\n\t\t//let fetchAllGoodsState = goodsAPI.endpoints.fetchAllGoods;\r\n\t\t//console.log(fetchAllGoodsState.select(this.state.lastArgs)(store.getState()));\r\n\t\t//console.log(fetchAllGoodsState);\r\n\t\t//console.log(this.state.lastArgs);\r\n\t\tif (isLoading) {\r\n\t\t\trows = isLoading;\r\n\t\t}\r\n\t\telse if (error) {\r\n\t\t\trows = error.data.error;\r\n\t\t}\r\n\t\telse if (data) {\r\n\t\t\tif (props.option === \"favorites\") {\r\n\t\t\t\trows = data.favorites[0][0].rows.map((fav) => <MyCard id={fav.good.id} name={fav.good.name} img={fav.good.photos} price={fav.good.price}\r\n\t\t\t\t\tcreatedAt={fav.good.created_at} nickname={fav.good.user?.nickname}\r\n\t\t\t\t\trating={fav.good.user?.rating} distance={fav.good.distance} key={fav.good.id} isByNick={props.option === \"profile\"} />);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\trows = data.goods[0].rows.map((goods) => <MyCard id={goods.id} name={goods.name} img={goods.photos} price={goods.price}\r\n\t\t\t\t\tcreatedAt={goods.created_at} nickname={goods.user?.nickname}\r\n\t\t\t\t\trating={goods.user?.rating} distance={goods.distance} key={goods.id} isByNick={props.option === \"profile\"}\r\n\t\t\t\t\tisAuthorized={data.authorized} />);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//console.log(this.props.fetchAllGoodsState(this.props.lastArgs));\r\n\t\t\r\n\t\t\r\n\t\t//console.log(fetchAllGoodsState(store.getState()));\r\n\t\t//console.log(this.props.activeCategoryName)\r\n\t\t//console.log(this.props.lastArgs);\r\n\t\tlet count = props.option === \"favorites\" ? data?.favorites[0][0].count : data?.goods[0].count;\r\n\r\n\t\treturn (\r\n\t\t\t//<div className=\"col-xs-12 col-sm-12 col-md-8 col-lg-9 mb-3 mt-3\">\r\n\t\t\t<>\r\n\t\t\t\t<main id={props.option !== \"profile\" ? \"goods-min\" : \"profile-goods-min\"}>\r\n\t\t\t  \t\t{rows}\r\n\t\t\t\t</main>\r\n\t\t\t\t{error ? null : (\r\n\t\t\t\t\t<div className={props.pageSize === 2 ? \"pl-7\" : null}>\r\n\t\t\t\t\t\t{data && count > 0 ? <button onClick={() => lastArgs?.since > 0 && move(\"left\")}>&#60;</button> : null}\r\n\t\t\t\t\t\t{data && count > 0 && lastArgs?.since > 1 ? \"...\" : null}\r\n\t\t\t\t\t\t{data && count > 0 && lastArgs?.since > 0\t? <button onClick={() => move(lastArgs?.since)}>{lastArgs?.since}</button> : null}\r\n\t\t\t\t\t\t{data && count > 0 ? <button className=\"underline\" onClick={() => move(lastArgs?.since + 1)}>{lastArgs?.since + 1}</button> : null}\r\n\t\t\t\t\t\t{data && count > (lastArgs?.since + 1) * props.pageSize ? <button onClick={() => move(lastArgs?.since + 2)}>{lastArgs?.since + 2}</button> : null}\r\n\t\t\t\t\t\t{data && count > (lastArgs?.since + 2) * props.pageSize ? \"...\" : null}\r\n\t\t\t\t\t\t{data && count > 0 ? <button onClick={() => (lastArgs?.since + 1) * props.pageSize < count && move(\"right\")}>&#62;</button> : null}\t\r\n\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</>\r\n\t\t\t//</div>\r\n\t\t);\r\n\t//}\r\n}\r\n\r\nfunction MyCard(props) {\r\n\t/*constructor(props) {\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\trender() {*/\r\n\t\t/*let date = new Date(this.props.createdAt);\r\n\t\tlet dateStr = date.toLocaleString('ru', {\r\n\t        year: 'numeric',\r\n\t        month: 'long',\r\n\t        day: 'numeric',\r\n\t        hour: 'numeric',\r\n\t        minute: 'numeric'\r\n\t      });\r\n\t\tlet butImg = [];\r\n\t\t//console.log(this.props.img);\r\n\t\tfor (let i = 0; i < this.props.img.length; i++) {\r\n\t\t\tif (i == 0)\r\n\t\t\t\tbutImg.push(<button type=\"button\" data-bs-target={\"#carouselGoodsIndicators\" + this.props.id} data-bs-slide-to={i} className=\"active\" aria-current=\"true\" aria-label={\"Slide \" + i}></button>);\r\n\t\t\telse\r\n\t\t\t\tbutImg.push(<button type=\"button\" data-bs-target={\"#carouselGoodsIndicators\" + this.props.id} data-bs-slide-to={i} aria-label={\"Slide \" + i}></button>);\r\n\t\t}\r\n\t\tlet img = [];\r\n\t\tfor (let i = 0; i < this.props.img.length; i++) {\r\n\t\t\tif (i == 0)\r\n\t\t\t\timg.push(<div className=\"carousel-item active\"><img className=\"d-block w-100\" src={\"goods_photos/\" + this.props.img[i]} alt={\"Slide \" + i}/></div>);\r\n\t\t\telse\r\n\t\t\t\timg.push(<div className=\"carousel-item\"><img className=\"d-block w-100\" src={\"goods_photos/\" + this.props.img[i]} alt={\"Slide \" + i}/></div>);\r\n\t\t}*/\r\n\r\n\t\tlet date = new Date(props.createdAt);\r\n\t\tlet dateStr = date.toLocaleString('ru', {\r\n\t        year: 'numeric',\r\n\t        month: 'long',\r\n\t        day: 'numeric',\r\n\t        hour: 'numeric',\r\n\t        minute: 'numeric'\r\n\t      });\r\n\t\treturn (\r\n\t\t\t/*<div className=\"col-xs-12 col-sm-12 col-md-4 col-lg-3\"  style={{float: 'left', height: '450px'}}>\r\n\t\t\t\t<div className=\"card m-1\">\r\n\t\t\t\t\t<div id={\"carouselGoodsIndicators\" + this.props.id} data-bs-interval=\"false\" className=\"carousel slide\" data-bs-ride=\"carousel\">\r\n\t\t\t\t\t<div className=\"carousel-indicators\">\r\n\t\t\t\t\t\t{butImg}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"carousel-inner\">\r\n\t\t\t\t\t\t{img}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<button className=\"carousel-control-prev\" type=\"button\" data-bs-target={\"#carouselGoodsIndicators\" + this.props.id} data-bs-slide=\"prev\">\r\n\t\t\t\t\t\t<span className=\"carousel-control-prev-icon\" aria-hidden=\"true\"></span>\r\n\t\t\t\t\t\t<span className=\"visually-hidden\">Previous</span>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button className=\"carousel-control-next\" type=\"button\" data-bs-target={\"#carouselGoodsIndicators\" + this.props.id} data-bs-slide=\"next\">\r\n\t\t\t\t\t\t<span className=\"carousel-control-next-icon\" aria-hidden=\"true\"></span>\r\n\t\t\t\t\t\t<span className=\"visually-hidden\">Next</span>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"card-body\">\r\n\t\t\t\t\t<a href={\"/goods/\" + this.props.id} target=\"_blank\" style={{color: \"black\"}}><h5 className=\"card-title\">{this.props.name.length > 45 ? this.props.name.substring(0, 45) + \"...\" : this.props.name}</h5></a>\r\n\t\t\t\t\t<p className=\"card-text\">{this.props.price + \"₽\"}</p>\r\n\t\t\t\t\t<p className=\"card-text\"><small className=\"text-muted\">{dateStr}</small></p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>*/\r\n\t\t\t<Card className=\"h-96 mb-5 bg-neutral-200\">\r\n\t\t\t\t{props.isByNick && props.isAuthorized ? <>\r\n\t\t\t\t\t<form action={\"/api/goods/\" + props.id} method=\"post\" enctype=\"multipart/form-data\">\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"status\" value=\"deleted\" />\r\n\t\t\t\t\t\t<button type=\"submit\" className=\"btn\">Удалить</button> \r\n\t\t\t\t\t</form>\r\n\t\t\t\t</> : null}\r\n\t\t\t\t<Carousel className=\"goods-carousel\" slide={false} indicators={false}>\r\n\t\t\t\t\t{props.img.map(img => <img src={\"/goods_photos/\" + img} alt=\"slide\" />)}\r\n\t\t\t\t</Carousel>\r\n\t\t\t\t<a href={\"/goods/\" + props.id} target=\"_blank\" style={{color: \"black\"}}><h5 className=\"break-words\">{props.name.length > 45 ? props.name.substring(0, 20) + \"...\" : props.name}</h5></a>\r\n\t\t\t\t{props.price ? <p>{props.price + \"₽\"}</p> : null}\r\n\t\t\t\t{props.isByNick ? null :\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\t<a href={props.nickname ? \"/user/\" + props.nickname : undefined}>{props.nickname ?? \"аноним\"}</a>\r\n\t\t\t\t\t\t{/* <span className='inline-block px-5 float-right text-lg'>{props.rating ?? \"-\"}<img alt=\"star\" src=\"/service_photos/star.png\" width=\"20\" className='inline'/></span> */}\r\n\t\t\t\t\t</p>\r\n\t\t\t\t}\r\n\t\t\t\t{props.distance && <p><small className=\"text-muted\">{\"Расстояние: \" + (props.distance / 1000).toFixed(1) + \"км\"}</small></p>}\r\n\t\t\t\t<p><small className=\"text-muted\">{dateStr}</small></p>\r\n\t\t\t</Card>\r\n\t\t);\r\n\t//}\r\n}\r\n\r\n/*const mapStateToProps = (state) => {\r\n    return {\r\n\t\tfetchAllGoodsState: (args) => goodsAPI.endpoints.fetchAllGoods.select(args)(state),\r\n\t\tfetchAllGoodsCatsState: (args) => goodsAPI.endpoints.fetchAllGoodsCats.select(args)(state),\r\n\t\tlastArgs: state.goodsReducer.lastArgs,\r\n\t\tactiveCategoryName: state.categoriesReducer.activeCategoryName\r\n    };\r\n}*/\r\n\r\n/*goods: state.goodsReducer.goods,\r\nisLoading: state.goodsReducer.isLoading,\r\nerror: state.goodsReducer.error*/\r\n\r\n/*const mapDispatchToProps =  (dispatch) => {\r\n  return {\r\n    getGoodsAll: (word, since, sort) => dispatch(getGoodsFromAPI(word, since, sort))\r\n  }\r\n}*/\r\n\r\n/*const mapDispatchToProps = {\r\n    fetchAllGoods: goodsAPI.endpoints.fetchAllGoods.initiate,//(args) => dispatch(goodsAPI.endpoints.fetchAllGoods.initiate(args)) //(args) => dispatch(getGoodsFromAPI(args))\r\n\tfetchAllGoodsCats: goodsAPI.endpoints.fetchAllGoodsCats.initiate,\r\n\tsetLastArgs: setLastArgs\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(GoodsMin);*/\r\n\r\nexport default GoodsMin;\r\n\r\n/*ReactDOM.render(\r\n  <GoodsMin />,\r\n  document.getElementById('goods-min')\r\n);\r\n\r\nclass Search extends React.Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.getGoods = this.getGoods.bind(this);\r\n\t\tthis.getGoodsURL = this.getGoodsURL.bind(this);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n        if (window.location.href.match(\"search=true\")) {\r\n        \tlet params = new URLSearchParams(new URL(window.location.href).search);\r\n\t\t\tlet query;\r\n\t\t\tlet sort;\r\n\t\t\tfor(let pair of params.entries()) {\r\n\t\t\t  if (pair[0] == 'query') {\r\n\t\t\t  \tquery = pair[1];\r\n\t\t\t  }\r\n\t\t\t  else if (pair[0] == 'sort') {\r\n\t\t\t  \tsort = pair[1];\r\n\t\t\t  }\r\n\t\t\t}\r\n        \tdocument.getElementById(\"search\").value = query;\r\n\t\t\tthis.getGoodsURL(query, 0, sort);\r\n\t\t}\r\n    }\r\n\r\n\tgetGoodsURL(query, since, sort) {\r\n\t\tfetch('/api', {\r\n\t\t\tmethod: 'POST',\r\n\t\t    headers: {\r\n\t\t      'Accept': 'application/json',\r\n\t\t      'Content-Type': 'application/json'\r\n\t\t    },\r\n\t\t    body: JSON.stringify({ command: 'searchGoods', word: query, since: since, sort: sort })\r\n\t\t}).then(response => {\r\n\t\t\tresponse.json().then(body => {\r\n\t\t\t\temitter.emit(\"CHANGE\", body.goods[0]);\r\n\t\t\t});\r\n\t\t});\r\n\t}*/\r\n\r\n\t/*getGoods(event) {\r\n\t\tfetch('/api', {\r\n\t\t\tmethod: 'POST',\r\n\t\t    headers: {\r\n\t\t      'Accept': 'application/json',\r\n\t\t      'Content-Type': 'application/json'\r\n\t\t    },\r\n\t\t    body: JSON.stringify({ command: 'searchGoods', word: document.getElementById(\"search\").value, since: 0 })\r\n\t\t}).then(response => {\r\n\t\t\tresponse.json().then(body => {\r\n\t\t\t\temitter.emit(\"CHANGE\", body.goods[0]);\r\n\t\t\t});\r\n\t\t});\r\n\t}*/\r\n\r\n\t/*getGoods(event) {\r\n\t\tconst url = new URL(window.location);\r\n\t\turl.searchParams.set('search', 'true');\r\n\t\turl.searchParams.set('query', document.getElementById(\"search\").value);\r\n\t\twindow.history.pushState({}, '', url);\r\n\t\twindow.location.reload();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div style={{textAlign: 'center', marginBottom: '25px'}}>\r\n\t\t\t\t<input type=\"text\" class=\"form-control\" id=\"search\" style={{display: 'inline', width: '60vw', marginRight: '10px'}}/>\r\n\t\t\t\t<button type=\"button\" class=\"btn btn-primary\" onClick={this.getGoods} style={{display: 'inline'}}>Найти!</button>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nReactDOM.render(\r\n  <Search />,\r\n  document.getElementById('search-wrapper')\r\n);\r\n\r\nvar links = [\r\n  \"Новые\",\r\n  \"Подписки\",\r\n  \"Популярные\"\r\n];\r\n\r\nclass NavBar extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.output = this.output.bind(this);\r\n    let params = new URLSearchParams(new URL(window.location.href).search);\r\n\tlet sort;\r\n\tfor(let pair of params.entries()) {\r\n\t  if (pair[0] == 'sort') {\r\n\t  \tsort = pair[1];\r\n\t  }\r\n\t}\r\n\tif (!sort || sort == 'new') {\r\n\t\tvar active = [true];\r\n\t    for (var i = 1; i < links.length; i++) {\r\n\t      active.push(false);\r\n\t    }\r\n\t}\r\n\telse if (sort == 'popular') {\r\n\t\tvar active = [];\r\n\t    for (var i = 0; i < links.length; i++) {\r\n\t      active.push(false);\r\n\t    }\r\n\t    active[2] = true;\r\n\t}\r\n\tthis.state = {isActive: active};\r\n  }\r\n\r\n  output = num => {\r\n    var active = [];\r\n    for (var i = 0; i < links.length; i++) {\r\n      active.push(false);\r\n    }\r\n    active[num] = true;\r\n    this.setState({ isActive : active});\r\n  }\r\n\r\n  render() {\r\n    var rows = [];\r\n    for (var i = 0; i < links.length; i++) {\r\n      rows.push(<Nav isActive={this.state.isActive[i]} name={links[i]} func={this.output}/>);\r\n    }\r\n    return (\r\n      <span>\r\n        {rows}\r\n        <LogReg/>\r\n      </span>\r\n    );\r\n  }\r\n}\r\n\r\nclass Nav extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    // Эта привязка обязательна для работы `this` в колбэке.\r\n    this.handleClick = this.handleClick.bind(this);\r\n  }\r\n\r\n  handleClick() {\r\n    var num;\r\n    for (var i = 0; i < links.length; i++) {\r\n      if (this.props.name == links[i]) {\r\n        num = i;\r\n      }\r\n    }\r\n    this.props.func(num);\r\n    if (this.props.name == \"Популярные\") {\r\n      const url = new URL(window.location);\r\n\t  url.searchParams.set('sort', 'popular');\r\n\t  window.history.pushState({}, '', url);\r\n\t  window.location.reload();\r\n    }\r\n    else if (this.props.name == \"Новые\") {\r\n      const url = new URL(window.location);\r\n\t  url.searchParams.set('sort', 'new');\r\n\t  window.history.pushState({}, '', url);\r\n\t  window.location.reload();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    var ariaCurrent = this.props.isActive ? \"page\" : null;\r\n    var className = 'nav-link';\r\n    if (this.props.isActive) {\r\n      className += ' active';\r\n    }\r\n    return (\r\n      <li className=\"nav-item d-block d-sm-block d-md-inline-block\"><a href=\"#\" className={className} aria-current={ariaCurrent} onClick={this.handleClick}>{this.props.name}</a></li>\r\n    );\r\n  }\r\n}\r\n\r\nclass LogReg extends React.Component {\r\n  constructor(props) {\r\n  \tsuper(props);\r\n  \tthis.state = {logout: false, confirm: null, nick: null};\r\n  }\r\n  componentDidMount() {\r\n  \tfetch('/api', {\r\n\t\t\tmethod: 'POST',\r\n\t\t    headers: {\r\n\t\t      'Accept': 'application/json',\r\n\t\t      'Content-Type': 'application/json'\r\n\t\t    },\r\n\t\t    body: JSON.stringify({ command: 'isLoggedIn' })\r\n\t\t}).then(response => {\r\n\t\t\tresponse.json().then(body => {\r\n\t\t\t\tthis.setState({logout: body.logout, confirm: body.confirm, nick: body.nick});\r\n\t\t\t});\r\n\t\t});\r\n  }\r\n  render() {\r\n  \tconsole.log(this.state);\r\n  \tif (!this.state.logout) {\r\n  \t  return (\r\n\t    <li className=\"nav-item d-block d-sm-block d-md-inline-block px-3\"><a href=\"/logreg\" className=\"nav-link\" id=\"logreg\">Вход/Регистрация</a></li>\r\n\t  );\r\n  \t}\r\n    else {\r\n      return (\r\n      \t<div className=\"dropdown d-block d-sm-block d-md-inline-block px-3\">\r\n          <button className=\"btn btn-primary dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n            {this.state.nick} {this.state.confirm ? \"(осуществлен вход)\" : \"(требуется подтверждение почты)\"}\r\n          </button>\r\n          <ul className=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\r\n            {this.state.confirm ? <li><a className=\"dropdown-item\" href=\"/goods/create\">Продать</a></li> : ''}\r\n            {this.state.confirm ? <li><a className=\"dropdown-item\" href=\"#\">Создано</a></li> : ''}\r\n            <li><a className=\"dropdown-item\" href=\"#\">Настройки</a></li>\r\n            <li><a className=\"dropdown-item\" href=\"/logout\">Выйти</a></li>\r\n          </ul>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nReactDOM.render(\r\n  <NavBar />,\r\n  document.getElementById('nav')\r\n);*/","export function calcCrow(lat1, lon1, lat2, lon2) {\r\n    var R = 6371; // km\r\n    var dLat = toRad(lat2-lat1);\r\n    var dLon = toRad(lon2-lon1);\r\n    var lat1 = toRad(lat1);\r\n    var lat2 = toRad(lat2);\r\n\r\n    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +\r\n    Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); \r\n    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \r\n    var d = R * c;\r\n    return d;\r\n}\r\n\r\n// Converts numeric degrees to radians\r\nexport function toRad(Value) {\r\n    return Value * Math.PI / 180;\r\n}"],"names":["React","useState","connect","useDispatch","useSelector","bindActionCreators","fetchAllGoodsState","goodsAPI","store","setLastArgs","Carousel","Card","useFetchAllGoodsCatsQuery","useFetchAllGoodsQuery","calcCrow","useEffect","useFetchGoodsByNickQuery","useGetFavoritesQuery","GoodsMin","props","dispatch","lastArgs","state","goodsReducer","query","category","option","_query","_objectSpread","nick","window","location","pathname","split","pop","slice","data","error","isLoading","getLocation","navigator","geolocation","getCurrentPosition","showPosition","alert","position","lat","coords","latitude","lon","longitude","move","arg","since","rows","favorites","map","fav","_fav$good$user","_fav$good$user2","createElement","MyCard","id","good","name","img","photos","price","createdAt","created_at","nickname","user","rating","distance","key","isByNick","goods","_goods$user","_goods$user2","isAuthorized","authorized","count","Fragment","className","pageSize","onClick","_props$nickname","date","Date","dateStr","toLocaleString","year","month","day","hour","minute","action","method","enctype","type","value","slide","indicators","src","alt","href","target","style","color","length","substring","undefined","toFixed","lat1","lon1","lat2","lon2","R","dLat","toRad","dLon","a","Math","sin","cos","c","atan2","sqrt","d","Value","PI"],"sourceRoot":""}